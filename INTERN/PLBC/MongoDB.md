## mongoDB STUDY

1. 몽고디비에서 파이썬으로 데이터 끌어올 때 어떻게 하면 더 빠르게 가져올 수 있을까?
현재 ) db.plbcManifest
      - 데이터 로딩하는 데에 걸린 시간: 155.0392439365387 초
      - CSV파일로 저장하는 데에 걸린 시간: 9.610374212265015 초
      - Excel파일로 저장하는 데에 걸린 시간: 560.4967248439789 초
  
      db.plbcContainerIoResult
      - 데이터 로딩하는 데에 걸린 시간: 52.47310209274292 초
      - CSV파일로 저장하는 데에 걸린 시간: 4.91783881187439 초
      - Excel파일로 저장하는 데에 걸린 시간: 149.93564176559448 초

---
https://devs0n.tistory.com/33

[병렬로 처리]
  db.plbcManifest
      
      - 데이터 로딩하는 데에 걸린 시간: 136.75098514556885 초
      
      - CSV파일로 저장하는 데에 걸린 시간: 6.960592031478882 초
      
      - Excel파일로 저장하는 데에 걸린 시간: 612.5646040439606 초

---
## NEW TASK

1. 몽고디비에서 'plbc.ContainerIoResult', 'plbc.ContainerInOut' 두 컬렉션의 전체 데이터 가져오기
2. plbcContainerIoResult는 'copionSeq'기준, plbcContainerInOut는 '_id' 기준으로 join 진행
3. join 결과 csv파일로 저장

>>각 단계별로 시간 얼마나 걸리는지 체크할 것.

---
## 근데 왜 동일한 코드를 실행시킬 때마다 시간이 달라질까??

![image](https://github.com/baesunny/study_note/assets/133308712/dba1c484-1896-4c03-bab7-cb61a943b728)

![image](https://github.com/baesunny/study_note/assets/133308712/236b556d-edc2-47a7-96bc-7283df08632a)


데이터를 불러올 때 시간이 얼마나 걸리는지 확인하고 측정하는 것은 아주 중요한데, 코드를 실행할 때마다 시간이 다르게 측정되니 증말 난감하군 ㅠㅠ

---

## 저장형태 별 시간 측정

- 몽고디비에서 대용량의 데이터 가져올 때 가장 빠른 형태 (상위 항목부터 순서대로)
  
      - JSON(JavaScript 개체 표기법)
  
      - BSON(바이너리 JSON)
  
      - CSV(쉼표로 구분된 값)


=> JSON 파일로의 저장과 CSV 파일로의 저장 둘 다 비교해봤는데 오히려 json이 더 오래 걸렸음. 

---

## 최종 정리

1. 콜렉션 별 전체데이터 로딩 시간 비교
   
   - plbc.ContainerIoResult
     
           - 전체 데이터 10,835,137개 (칼럼 13개)
     
           - 데이터 로딩시간 754.7초
     
           - 데이터프레임 변환시간 276.5초
   
           - 총 752.6초


   - plbc.ContainerInOut
     
           - 전체 데이터 13,626,405개 (칼럼 24개)
     
           - 데이터 로딩시간 1786.9초
     
           - 데이터프레임 변환시간 2508.2초
     
           - 총 4295.03초



3. 데이터 join
   
   - plbcContainerIoResult는 'copionSeq'기준
     
   - plbcContainerInOut는 '_id' 기준
     
   - join 결과 데이터 총 10,598,363개 (칼럼 37개)
     
   - 데이터 join 시간 1143.5초



4. csv파일로 저장

   - CSV 파일 저장시간 148.4초

  
5. 전체시간

   - 두 개의 컬렉션 전체데이터 로딩 + 데이터프레임 변환 + 테이블 JOIN + CSV파일 저장
  
   - 약 6339.5초 (약 105분)


7. 기타사항
   
   - 위의 결과는 로컬 환경에서 돌린 것이기에 서버에서 실행하면 시간이 단축될 수 있습니다.
  
   - 동일한 코드를 재실행 시킬 때마다 시간이 느려지는 문제를 파악하여 현재 원인을 찾고있는 중입니다.
     
   - JSON 형태로의 저장, batch_size 조정, 병렬로 로딩 등 시간 단축을 위한 여러 가지 방법으로 실험 진행 중에 있습니다. 혹시라도 변동사항이 생긴다면 다시 말씀드리겠습니다.
  

---

## 100만개 기준

- 로컬 환경  :  198.7초
- 서버환경  :  213.7초
- JOIN 해서 불러오기  :  298초

